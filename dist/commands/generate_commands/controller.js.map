{"version":3,"sources":["commands/generate_commands/controller.js"],"names":["handler","path","fs","_","writeFileFromTemplate","getConfiguration","command","desc","builder","argv","options","test","name","console","error","process","exit","controllerName","upperFirst","camelCase","concat","controllerFile","dasherize","log","controllerPath","resolve","cwd","base","existsSync","templateFile","__dirname","destFolder","dirname","ensureDir","err","replace","then","catch"],"mappings":";;;;;;QAoBgBA,O,GAAAA,O;;AAZhB;;IAAOC,I;;AACP;;IAAOC,E;;AACP;;IAAOC,C;;AACP;;IAAQC,qB,SAAAA,qB;IAAuBC,gB,SAAAA,gB;;;;AAX/B;;;;;;;;AAaO,IAAMC,4BAAU,mBAAhB;;AAEA,IAAMC,sBAAO,2BAAb;;AAEA,IAAMC,4BAAU,EAAhB;;AAGA,SAASR,OAAT,CAAiBS,IAAjB,EAAuB;AAC1B,QAAIC,UAAUL,kBAAd;AACA;AACA,QAAI,CAAC,kBAAkBM,IAAlB,CAAuBF,KAAKG,IAA5B,CAAL,EAAwC;AACpCC,gBAAQC,KAAR,CAAc,OAAd,EAAsB,yFAAtB;AACA,eAAOC,QAAQC,IAAR,CAAa,CAAb,CAAP;AACH;AACA;AACD,QAAIC,iBAAiB,eAAeN,IAAf,CAAoBF,KAAKG,IAAzB,IAAiCT,EAAEe,UAAF,CAAaf,EAAEgB,SAAF,CAAYV,KAAKG,IAAjB,CAAb,CAAjC,GAAwET,EAAEe,UAAF,CAAaf,EAAEgB,SAAF,CAAYV,KAAKG,IAAL,CAAUQ,MAAV,CAAiB,aAAjB,CAAZ,CAAb,CAA7F;AACA;AACA,QAAIC,iBAAiBlB,EAAEmB,SAAF,CAAYL,cAAZ,EAA4BG,MAA5B,CAAmC,KAAnC,CAArB;AACAP,YAAQU,GAAR,CAAY,MAAZ,6BAA4CF,cAA5C;AACA,QAAIG,iBAAiBvB,KAAKwB,OAAL,CAAaV,QAAQW,GAAR,EAAb,EAA4BhB,QAAQiB,IAApC,mBAAyDN,cAAzD,CAArB;AACAR,YAAQU,GAAR,CAAY,MAAZ,kCAAiDC,cAAjD;AACA,QAAItB,GAAG0B,UAAH,CAAcJ,cAAd,CAAJ,EAAmC;AAC/BX,gBAAQC,KAAR,CAAc,OAAd,EAAsB,0CAAtB;AACA,eAAOC,QAAQC,IAAR,CAAa,CAAb,CAAP;AACH;AACD;AACA,QAAIa,eAAe5B,KAAKwB,OAAL,CAAaK,SAAb,EAAuB,+CAAvB,CAAnB;;AAEA;AACA,QAAIC,aAAa9B,KAAK+B,OAAL,CAAaR,cAAb,CAAjB;AACAX,YAAQC,KAAR,CAAc,MAAd,qCAAsDiB,UAAtD;AACA7B,OAAG+B,SAAH,CAAaF,UAAb,EAAyB,UAACG,GAAD,EAAQ;AAC9B,YAAIA,GAAJ,EAAS;AACLrB,oBAAQC,KAAR,CAAc,OAAd,EAAsB,sDAAtB;AACCD,oBAAQC,KAAR,CAAcoB,GAAd;AACJ;AACD9B,8BAAsByB,YAAtB,EAAoCL,cAApC,EAAoD;AAC/CZ,kBAAKK,eAAekB,OAAf,CAAuB,cAAvB,EAAsC,EAAtC;AAD0C,SAApD,EAEIC,IAFJ,CAES,YAAK;AACTvB,oBAAQU,GAAR,CAAY,MAAZ,EAAmB,0CAAnB;AACE,mBAAOR,QAAQC,IAAR,CAAa,CAAb,CAAP;AACL,SALF,EAKIqB,KALJ,CAKU,UAACH,GAAD,EAAQ;AACbrB,oBAAQC,KAAR,CAAc,OAAd,EAAsB,gDAAtB;AACAD,oBAAQC,KAAR,CAAcoB,GAAd;AACA,mBAAOnB,QAAQC,IAAR,CAAa,CAAb,CAAP;AACH,SATF;AAWF,KAhBD;AAkBH","file":"controller.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2017, THEMOST LP All rights reserved\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\nimport path from 'path';\nimport fs from 'fs-extra';\nimport _ from 'lodash';\nimport {writeFileFromTemplate, getConfiguration} from '../../util';\n\nexport const command = 'controller <name>';\n\nexport const desc = 'Generate a new controller';\n\nexport const builder = {\n};\n\nexport function handler(argv) {\n    let options = getConfiguration();\n    //validating controller name\n    if (!/^[a-zA-Z0-9_]+$/.test(argv.name)) {\n        console.error('ERROR','Controller name is not valid. Expected only latin characters, numbers or \"_\" character.');\n        return process.exit(1);\n    }\n     //get controller name\n    let controllerName = /controller$/i.test(argv.name) ? _.upperFirst(_.camelCase(argv.name)) : _.upperFirst(_.camelCase(argv.name.concat('-controller')));\n    //get controller file name\n    let controllerFile = _.dasherize(controllerName).concat('.js');\n    console.log('INFO',`Generating controller ${controllerFile}`);\n    let controllerPath = path.resolve(process.cwd(), options.base, `controllers/${controllerFile}`);\n    console.log('INFO',`Validating controller path ${controllerPath}`);\n    if (fs.existsSync(controllerPath)) {\n        console.error('ERROR','The specified controller already exists.');\n        return process.exit(1);\n    }\n    //get template file path\n    let templateFile = path.resolve(__dirname,'../../../templates/generate/controller.js.ejs');\n    \n    //get destination folder path\n    let destFolder = path.dirname(controllerPath);\n    console.error('INFO',`Validating controller folder (${destFolder}).`);\n    fs.ensureDir(destFolder, (err)=> {\n       if (err) {\n           console.error('ERROR','An error occurred while validating destination path.');\n            console.error(err);\n       } \n       writeFileFromTemplate(templateFile, controllerPath, {\n            name:controllerName.replace(/Controller$/i,'')\n        }).then(()=> {\n            console.log('INFO','The operation was completed succesfully.');\n              return process.exit(0);\n        }).catch((err)=> {\n            console.error('ERROR','An error occurred while generating controller.');\n            console.error(err);\n            return process.exit(1);\n        });\n       \n    });\n    \n}"]}